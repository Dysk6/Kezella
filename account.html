<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Account | Kezeélla</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>

<header class="header">
  <div class="logo">Kezeélla</div>
  <nav class="nav">
    <a href="shop.html" class="nav-link">Shop</a>
    <a href="account.html" class="nav-link" style="color: gold;">Account</a>
    <a href="cart.html" class="cart-link">
      <i class="fas fa-bag-shopping"></i>
      <span id="cartCount">0</span>
    </a>
  </nav>
</header>

<div class="account-page-container">
  
  <div id="authForms" class="auth-container">
    
    <div id="loginBox">
      <h2>Sign In</h2>
      <p>Welcome back to Kezeélla.</p>
      <form onsubmit="handleLogin(event)">
        <input type="email" id="loginEmail" placeholder="Email Address" required>
        <input type="password" id="loginPass" placeholder="Password" required>
        <button type="submit" class="auth-btn">Log In</button>
      </form>
      <p class="switch-text">New here? <span onclick="showRegister()">Create an account</span></p>
    </div>

    <div id="registerBox" style="display: none;">
      <h2>Create Account</h2>
      <p>Join the Kezeélla exclusive list.</p>
      <form onsubmit="handleRegister(event)">
        <input type="text" id="regName" placeholder="Full Name" required>
        <input type="email" id="regEmail" placeholder="Email Address" required>
        <input type="password" id="regPass" placeholder="Password" required>
        <button type="submit" class="auth-btn">Register</button>
      </form>
      <p class="switch-text">Already a member? <span onclick="showLogin()">Sign In</span></p>
    </div>
  </div>

  <div id="userDashboard" class="dashboard-container" style="display: none;">
    <div class="dashboard-header">
      <h1 id="welcomeName">Welcome, User</h1>
      <button onclick="logout()" class="logout-btn">Log Out</button>
    </div>

    <div class="dashboard-grid">
      <div class="dash-card">
        <h3>Member Status</h3>
        <p style="color: gold; margin-top: 10px;">Active • Verified</p>
      </div>
      <div class="dash-card">
        <h3>Saved Details</h3>
        <p id="dashEmail" style="color: #888; margin-top: 10px;">email@example.com</p>
      </div>
    </div>

    <div class="danger-zone">
      <h3>Danger Zone</h3>
      <p>Deleting your account is permanent. You will not be able to create a new account with this device.</p>
      <button onclick="deleteAccount()" class="delete-btn">Permanently Delete Account</button>
    </div>
  </div>

</div>

<footer id="contact" class="footer">
  <div class="footer-bottom"><p>© Kezeélla Luxury Fashion</p></div>
</footer>

<script src="script.js"></script>
<script>
  // ACCOUNT PAGE SPECIFIC LOGIC
  // We keep this here so it doesn't slow down the homepage
  
  const authForms = document.getElementById("authForms");
  const dashboard = document.getElementById("userDashboard");

  // Check login status on load
  window.onload = function() {
    checkInactivity(); // Run the 12-month check
    const user = JSON.parse(localStorage.getItem("kezeella_user"));
    if(user) {
      showDashboard(user);
    } else {
      authForms.style.display = "block";
    }
    updateGlobalCartCount(); // From script.js
  };

  function showRegister() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("registerBox").style.display = "block";
  }

  function showLogin() {
    document.getElementById("registerBox").style.display = "none";
    document.getElementById("loginBox").style.display = "block";
  }

  function handleRegister(e) {
    e.preventDefault();
    const name = document.getElementById("regName").value;
    const email = document.getElementById("regEmail").value;
    const pass = document.getElementById("regPass").value;

    // 1. CHECK IF BANNED
    if (localStorage.getItem("kezeella_banned_email") === email || localStorage.getItem("kezeella_device_ban") === "true") {
      alert("Registration Failed: This account/device was previously deleted and is restricted from creating a new account.");
      return;
    }

    // 2. CREATE USER
    const user = {
      name: name,
      email: email,
      pass: pass, // In a real app, never save passwords like this!
      joined: new Date().getTime(),
      lastLogin: new Date().getTime()
    };

    localStorage.setItem("kezeella_user", JSON.stringify(user));
    alert("Account created successfully!");
    showDashboard(user);
  }

  function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const pass = document.getElementById("loginPass").value;
    const storedUser = JSON.parse(localStorage.getItem("kezeella_user"));

    if (storedUser && storedUser.email === email && storedUser.pass === pass) {
      // Update last login time
      storedUser.lastLogin = new Date().getTime();
      localStorage.setItem("kezeella_user", JSON.stringify(storedUser));
      showDashboard(storedUser);
    } else {
      alert("Invalid email or password.");
    }
  }

  function showDashboard(user) {
    authForms.style.display = "none";
    dashboard.style.display = "block";
    document.getElementById("welcomeName").innerText = "Welcome, " + user.name.split(" ")[0];
    document.getElementById("dashEmail").innerText = user.email;
  }

  function logout() {
    // Just refresh, don't delete data
    window.location.reload();
  }

  function deleteAccount() {
    if(confirm("WARNING: Are you sure? You will NOT be able to create an account again on this device.")) {
      const user = JSON.parse(localStorage.getItem("kezeella_user"));
      
      // 1. SET THE BAN FLAGS
      localStorage.setItem("kezeella_banned_email", user.email);
      localStorage.setItem("kezeella_device_ban", "true");
      
      // 2. REMOVE USER DATA
      localStorage.removeItem("kezeella_user");
      
      alert("Account deleted. We are sorry to see you go.");
      window.location.reload();
    }
  }

  function checkInactivity() {
    const user = JSON.parse(localStorage.getItem("kezeella_user"));
    if (user) {
      const now = new Date().getTime();
      const oneYear = 365 * 24 * 60 * 60 * 1000; // 12 Months in milliseconds
      
      // If inactive for > 1 year
      if (now - user.lastLogin > oneYear) {
        localStorage.removeItem("kezeella_user");
        // We DO NOT ban them here, so they can recreate.
        alert("Your account was deleted due to 12 months of inactivity. Please create a new one.");
        window.location.reload();
      }
    }
  }
</script>

</body>
</html>
